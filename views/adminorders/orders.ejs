<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Admin Orders</title>
        <!-- Bootstrap CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet" />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
            rel="stylesheet" />
        <style>
      body {
        background-color: #f8f9fa;
        color: #212529;
      }
      .content {
        margin-left: 250px;
        padding: 30px;
      }
      .content h2 {
        margin-bottom: 20px;
      }
      .table th {
        background-color: #007bff;
        color: #fff;
      }
      .btn-custom {
        background-color: #007bff;
        color: #fff;
        border: none;
      }
      .btn-custom:hover {
        background-color: #0056b3;
      }
    </style>
    </head>
    <body>
        <div class="content">
            <h2>Order Management</h2>

            <!-- Search + Filter -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <!-- Search Bar -->
                <!-- <input
                    type="text"
                    id="searchInput"
                    class="form-control w-50"
                    placeholder="Search by Order ID / Phone..."
                    value="<%= search || '' %>" /> -->

                <!-- Status Filter -->
                <select id="statusFilter" class="form-select w-25">
                    <option value="all" <%=!status || status === 'all' ?
                        'selected' : '' %>>All Status</option>
                    <% [
                    'pending','processing','shipped','delivered',
                    'pending_return','processing_return','initiated_return',
                    'rejected_return','returned','refunded','cancelled',
                    'payment_failed','out_of_stock','on_hold','failed'
                    ].forEach(s => { %>
                    <option value="<%= s %>" <%=status === s ? 'selected' : ''
                        %>><%= s %></option>
                    <% }) %>
                </select>
            </div>

            <!-- Orders Table -->
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th scope="col">Order ID</th>
                        <th scope="col">User Name</th>
                        <th scope="col">Total Price</th>
                        <th scope="col">Status</th>
                        <th scope="col">Order Date</th>
                        <th scope="col">Payment Method</th>
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% orders.forEach((order) => { %>
                    <tr>
                        <td><%= order.genOrderId %></td>
                        <td><%= order.userId ? order.userId.name : 'No User'
                            %></td>
                        <td>â‚¹<%= order.totalPrice %></td>
                        <td><%= order.status %></td>
                        <td><%= new Date(order.orderDate).toLocaleDateString()
                            %></td>
                        <td><%= order.paymentDetails.paymentMethod %></td>
                        <td>
                            <a class="btn btn-custom btn-sm"
                                href="/admin/orders/<%= order._id %>">
                                <i class="fas fa-eye"></i> View & Edit
                            </a>
                        </td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>

            <!-- Pagination Controls -->
            <nav aria-label="Page navigation">
                <ul class="pagination">
                    <li
                        class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                        <a class="page-link"
                            href="?page=<%= currentPage - 1 %>&limit=10&search=<%= search || '' %>&status=<%= status || 'all' %>"
                            aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                    <% for (let i = 1; i <= totalPages; i++) { %>
                    <li
                        class="page-item <%= currentPage === i ? 'active' : '' %>">
                        <a class="page-link"
                            href="?page=<%= i %>&limit=10&search=<%= search || '' %>&status=<%= status || 'all' %>"><%=
                            i %></a>
                    </li>
                    <% } %>
                    <li
                        class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                        <a class="page-link"
                            href="?page=<%= currentPage + 1 %>&limit=10&search=<%= search || '' %>&status=<%= status || 'all' %>"
                            aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>

        <!-- Scripts -->
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script>
  function debounce(func, delay) {
    let timer;
    return function (...args) {
      clearTimeout(timer);
      timer = setTimeout(() => func.apply(this, args), delay);
    };
  }

  const searchInput = document.getElementById("searchInput"); // might be null
  const statusFilter = document.getElementById("statusFilter");

  function applyFilters() {
    const search = searchInput ? searchInput.value.trim() : ""; // safe
    const status = statusFilter.value;
    const url = `?search=${encodeURIComponent(search)}&status=${status}&page=1&limit=10`;
    window.location.href = url;
  }

  if (searchInput) {
    searchInput.addEventListener("keyup", debounce(applyFilters, 500));
  }
  statusFilter.addEventListener("change", applyFilters);
</script>

    </body>
</html>
