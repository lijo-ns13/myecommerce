<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Admin Orders</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet" />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
            rel="stylesheet" />
        <style>
    body {
      background-color: #f8f9fa;
    }
    .content {
      margin-left: 250px;
      padding: 20px;
    }
    .table th {
      background-color: #0d6efd;
      color: #fff;
      text-transform: uppercase;
      font-size: 0.85rem;
    }
    .status-badge {
      font-size: 0.75rem;
      padding: 0.4em 0.8em;
      border-radius: 50px;
    }
    .status-pending { background-color: #ffc107; color: #212529; }
    .status-processing { background-color: #17a2b8; color: #fff; }
    .status-shipped { background-color: #0dcaf0; color: #fff; }
    .status-delivered { background-color: #28a745; color: #fff; }
    .status-cancelled { background-color: #dc3545; color: #fff; }
    .btn-custom {
      background-color: #0d6efd;
      color: #fff;
    }
    .btn-custom:hover {
      background-color: #084298;
    }
  </style>
    </head>
    <body>
        <div class="content">
            <h2 class="fw-bold mb-4">Order Management</h2>

            <!-- Search + Filter -->
            <div class="d-flex flex-wrap gap-3 mb-4">
                <!-- <input
                    type="text"
                    id="searchInput"
                    class="form-control w-50"
                    placeholder="Search by Order ID / Phone..."
                    value="<%= search || '' %>" /> -->

                <select id="statusFilter" class="form-select w-25">
                    <option value="all" <%=!status || status === 'all' ?
                        'selected' : '' %>>All Status</option>
                    <% [
                    'pending','processing','shipped','delivered',
                    'pending_return','processing_return','initiated_return',
                    'rejected_return','returned','refunded','cancelled',
                    'payment_failed','out_of_stock','on_hold','failed'
                    ].forEach(s => { %>
                    <option value="<%= s %>" <%=status === s ? 'selected' : ''
                        %>><%= s %></option>
                    <% }) %>
                </select>
            </div>

            <!-- Orders Table -->
            <div class="card shadow-sm">
                <div class="card-body p-0">
                    <table class="table table-hover align-middle mb-0">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>User</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Order Date</th>
                                <th>Payment</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <% orders.forEach((order) => { %>
                            <tr>
                                <td class="fw-medium"><%= order.genOrderId
                                    %></td>
                                <td><%= order.userId ? order.userId.name :
                                    'Guest' %></td>
                                <td><%= new
                                    Intl.NumberFormat('en-IN',{style:'currency',currency:'INR'}).format(order.totalPrice)
                                    %></td>
                                <td>
                                    <span
                                        class="status-badge status-<%= order.status %>">
                                        <%= order.status.replace(/_/g,
                                        " ").toUpperCase() %>
                                    </span>
                                </td>
                                <td><%= new
                                    Intl.DateTimeFormat('en-GB',{dateStyle:'medium'}).format(new
                                    Date(order.orderDate)) %></td>
                                <td><%= order.paymentDetails.paymentMethod
                                    %></td>
                                <td>
                                    <a class="btn btn-sm btn-custom"
                                        href="/admin/orders/<%= order._id %>">
                                        <i class="fas fa-eye"></i> View
                                    </a>
                                </td>
                            </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Pagination -->
            <nav aria-label="Page navigation" class="mt-4">
                <ul class="pagination justify-content-center">
                    <li
                        class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                        <a class="page-link"
                            href="?page=<%= currentPage - 1 %>&limit=10&search=<%= search || '' %>&status=<%= status || 'all' %>">&laquo;</a>
                    </li>
                    <% for (let i = 1; i <= totalPages; i++) { %>
                    <li
                        class="page-item <%= currentPage === i ? 'active' : '' %>">
                        <a class="page-link"
                            href="?page=<%= i %>&limit=10&search=<%= search || '' %>&status=<%= status || 'all' %>"><%=
                            i %></a>
                    </li>
                    <% } %>
                    <li
                        class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                        <a class="page-link"
                            href="?page=<%= currentPage + 1 %>&limit=10&search=<%= search || '' %>&status=<%= status || 'all' %>">&raquo;</a>
                    </li>
                </ul>
            </nav>
        </div>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script>
    function debounce(func, delay) {
      let timer;
      return function (...args) {
        clearTimeout(timer);
        timer = setTimeout(() => func.apply(this, args), delay);
      };
    }

    const searchInput = document.getElementById("searchInput");
    const statusFilter = document.getElementById("statusFilter");

    function applyFilters() {
      const search = searchInput ? searchInput.value.trim() : "";
      const status = statusFilter.value;
      const url = `?search=${encodeURIComponent(search)}&status=${status}&page=1&limit=10`;
      window.location.href = url;
    }

    if (searchInput) {
      searchInput.addEventListener("keyup", debounce(applyFilters, 500));
    }
    statusFilter.addEventListener("change", applyFilters);
  </script>
    </body>
</html>
