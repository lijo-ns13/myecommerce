<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Admin Order Detail</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet">
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
            rel="stylesheet">
        <style>
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f8f9fa;
    }

    .card {
        margin-left: 250px;
            padding: 20px;
            transition: all 0.3s;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .card-header {
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
    }

    .badge {
      padding: 0.45rem 0.75rem;
      font-size: 0.85rem;
      border-radius: 50px;
    }

    .order-info p {
      margin-bottom: 0.4rem;
    }

    .product-item {
      border-bottom: 1px solid #e9ecef;
      padding: 15px 0;
    }

    .product-item:last-child {
      border-bottom: none;
    }

    .product-item img {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 6px;
    }

    @media (max-width: 768px) {
      .product-item {
        flex-direction: column;
        align-items: flex-start;
      }

      .product-item img {
        margin-bottom: 10px;
      }
    }
  </style>
    </head>

    <body>
        <div class="container py-4">
            <!-- Order ID -->
            <div class="text-center mb-4">
                <h3 class="fw-bold">Order <span class="text-primary">#<%=
                        order._id %></span></h3>
            </div>

            <!-- Summary Card -->
            <div class="card mb-4">
                <div
                    class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Total:
                        <%= new
                        Intl.NumberFormat('en-US',{style:'currency',currency:'USD'}).format(order.totalPrice)
                        %>
                    </h5>
                    <span
                        class="badge <%= order.paymentDetails.transactionId ? 'bg-success' : 'bg-warning text-dark' %>">
                        <%= order.paymentDetails.transactionId ? 'Paid' :
                        'Not Paid' %>
                    </span>
                </div>
                <div class="card-body order-info">
                    <p><strong>Status:</strong>
                        <span
                            class="badge bg-<%= order.status === 'delivered' ? 'success' : order.status === 'shipped' ? 'info' : order.status === 'pending' ? 'warning text-dark' : 'secondary' %>">
                            <%= order.status.charAt(0).toUpperCase() +
                            order.status.slice(1) %>
                        </span>
                    </p>
                    <p><strong>Order Date:</strong>
                        <%= new
                        Intl.DateTimeFormat('en-GB',{dateStyle:'medium',timeStyle:'short'}).format(new
                        Date(order.orderDate)) %>
                    </p>
                    <p><strong>Delivery Date:</strong>
                        <%= new
                        Intl.DateTimeFormat('en-GB',{dateStyle:'medium',timeStyle:'short'}).format(new
                        Date(order.deliveryDate)) %>
                    </p>
                    <hr>
                    <h6>Payment</h6>
                    <p><strong>Method:</strong> <%=
                        order.paymentDetails.paymentMethod %></p>
                    <p><strong>Transaction ID:</strong> <%=
                        order.paymentDetails.transactionId || 'N/A' %></p>
                    <hr>
                    <h6>Shipping Address</h6>
                    <p><i class="fas fa-phone me-2"></i> <%=
                        order.shippingAddress.phoneNo %></p>
                    <p><i class="fas fa-map-marker-alt me-2"></i>
                        <%= order.shippingAddress.street %>, <%=
                        order.shippingAddress.city %>, <%=
                        order.shippingAddress.state %>,
                        <%= order.shippingAddress.zip %>, <%=
                        order.shippingAddress.country %>
                    </p>
                </div>
            </div>

            <!-- Status Update -->
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Update Order Status</h5>
                </div>
                <div class="card-body">
                    <form action="/admin/orders/<%= order._id %>/edit"
                        method="POST">
                        <div class="mb-3">
                            <label for="status" class="form-label">Select
                                Status</label>
                            <select id="status" name="status"
                                class="form-select"></select>
                        </div>
                        <button type="submit"
                            class="btn btn-primary">Update</button>
                        <a href="/admin/orders"
                            class="btn btn-secondary">Cancel</a>
                    </form>
                </div>
            </div>

            <!-- Products -->
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Ordered Products</h5>
                </div>
                <div class="card-body">
                    <% order.orderedProducts.forEach(product => { %>
                    <div class="product-item d-flex align-items-center">
                        <img src="<%= product.productImage %>"
                            alt="<%= product.productName %>">
                        <div class="ms-3">
                            <h6><%= product.productName %></h6>
                            <p class="mb-1">Size: <%= product.productSize %></p>
                            <p class="mb-1">Qty: <%= product.productQuantity
                                %></p>
                            <p class="mb-1">Unit: <%= new
                                Intl.NumberFormat('en-US',{style:'currency',currency:'USD'}).format(product.productPrice)
                                %></p>
                            <p class="fw-bold">Subtotal:
                                <%= new
                                Intl.NumberFormat('en-US',{style:'currency',currency:'USD'}).format(product.productPrice
                                * product.productQuantity) %>
                            </p>
                        </div>
                    </div>
                    <% }) %>
                </div>
            </div>
        </div>

        <script>
    document.addEventListener("DOMContentLoaded", function () {
      const currentStatus = "<%= order.status %>";
      const statusSelect = document.getElementById("status");

      const validTransitions = {
        "pending": ["processing", "cancelled"],
        "processing": ["shipped", "cancelled"],
        "shipped": ["delivered"],
        "delivered": [],
        "cancelled": [],
        "pending_return": ["processing_return", "rejected_return"],
        "processing_return": ["initiated_return", "rejected_return"],
        "initiated_return": ["returned", "rejected_return"],
        "returned": ["refunded"],
        "refunded": [],
        "out_of_stock": ["pending", "processing"],
        "on_hold": ["pending", "processing"],
        "payment_failed": []
      };

      const options = [currentStatus, ...(validTransitions[currentStatus] || [])];
      options.forEach(status => {
        const opt = document.createElement("option");
        opt.value = status;
        opt.textContent = status.replace(/_/g, " ").replace(/\b\w/g, c => c.toUpperCase());
        opt.selected = status === currentStatus;
        statusSelect.appendChild(opt);
      });
    });
  </script>
    </body>
</html>
