<!DOCTYPE html>
<html lang="en">
<!-- noted -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= product.product %> - Product Detail</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        body {
            margin:0;
            padding:0;
            box-sizing: border-box;
        }
		:root {
    --primary-color: #3498db;
    --secondary-color: #e74c3c;
    --accent-color: #f39c12;
    --background-color: #f4f4f4;
    --text-color: #333;
}

/* body {
    font-family: 'Poppins', sans-serif;
    background-color: var(--background-color);
    color: var(--text-color);
} */

.navbar {
    background-color: rgba(255, 255, 255, 0.9) !important;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.navbar-brand img {
    max-height: 50px;
}

.navbar-nav {
    display: flex; /* Use flexbox for alignment */
    align-items: center; /* Center items vertically */
    list-style: none; /* Remove default list styles */
    padding: 0; /* Remove default padding */
    margin: 0; /* Remove default margin */
}

.nav-item {
    margin: 0 10px; /* Set uniform horizontal spacing */
}

.nav-link {
    display: flex; /* Use flexbox for proper alignment */
    align-items: center; /* Center items vertically */
    text-decoration: none; /* Remove underline from links */
    color: #333; /* Set a default text color */
    font-size: 18px; /* Set a uniform font size */
    font-weight: 600; /* Set font weight */
    transition: color 0.3s ease; /* Transition for hover effect */
}

.nav-link:hover {
    color: var(--primary-color) !important; /* Hover color */
}

.nav-link i {
    font-size: 24px; /* Set a uniform icon size */
    margin-right: 5px; /* Space between icon and text */
}

.rounded-circle {
    width: 30px; /* Set a fixed width for the user profile image */
    height: 30px; /* Set a fixed height for the user profile image */
}


        .product-detail {
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        padding: 30px;
        margin-bottom: 30px;
    }
    .main-image-container {
        transition: all 0.3s ease;
    }
    .main-image-container:hover {
        transform: scale(1.02);
    }
    .image-overlay {
        background-color: rgba(0, 0, 0, 0.5);
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    .main-image-container:hover .image-overlay {
        opacity: 1;
    }
    .thumbnail {
        cursor: pointer;
        transition: all 0.3s ease;
    }
    .thumbnail:hover {
        transform: scale(1.05);
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }
    .product-title {
        font-size: 2.5rem;
        font-weight: 700;
    }
    .size-button {
        min-width: 50px;
    }
    .size-button.active {
        background-color: #007bff;
        color: #fff;
    }
/* Ensure the colors align with your design */
.text-danger {
    color: red; /* Color for liked items */
}

.text-muted {
    color: gray; /* Color for not liked items */
}
.btn-wishlist {
    font-size: 16px;
    font-weight: 600;
    color: #ff5252;  /* Red color for the heart icon */
    background-color: transparent;
    border-color: #ff5252;  /* Red border for the button */
    border-radius: 30px;
    padding: 8px 20px;
    transition: background-color 0.3s, color 0.3s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.btn-wishlist:hover {
    background-color: #ff5252;  /* Red background on hover */
    color: white;  /* White text on hover */
}

.btn-wishlist i {
    font-size: 18px;
}

/* reviews */
.reviews-container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .section-title {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 2rem;
            text-align: center;
            font-weight: 700;
        }
        .rating-summary {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 2rem;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 2rem;
        }
        .rating-number {
            font-size: 4rem;
            font-weight: bold;
            line-height: 1;
            margin-bottom: 0.5rem;
        }
        .star-rating {
            font-size: 1.5rem;
            color: #ffd700;
        }
        .review-count {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        .rating-bars {
            background-color: #f1f3f5;
            padding: 1.5rem;
            border-radius: 10px;
        }
        .rating-bar {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        .bar-label {
            flex: 0 0 50px;
            font-weight: bold;
        }
        .progress {
            flex-grow: 1;
            height: 12px;
            background-color: #e9ecef;
            border-radius: 6px;
            overflow: hidden;
            margin: 0 1rem;
        }
        .progress-bar {
            height: 100%;
            background-color: #ffd700;
            transition: width 0.3s ease;
        }
        .bar-value {
            flex: 0 0 40px;
            text-align: right;
            font-size: 0.9rem;
            color: #6c757d;
        }
        .review-item {
            background-color: #ffffff;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .review-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .user-info {
            display: flex;
            align-items: center;
        }
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 1rem;
            object-fit: cover;
        }
        .user-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        .review-date {
            font-size: 0.9rem;
            color: #6c757d;
        }
        .review-content {
            line-height: 1.6;
        }
        .btn-review {
            display: inline-block;
            background-color: #007bff;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
            transition: background-color 0.2s ease;
            margin-top: 1rem;
        }
        .btn-review:hover {
            background-color: #0056b3;
        }
        .btn-delete, .btn-edit {
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.9rem;
            margin-right: 0.5rem;
            transition: opacity 0.2s ease;
        }
        .btn-delete {
            background-color: #dc3545;
            color: white;
            border: none;
        }
        .btn-edit {
            background-color: #ffc107;
            color: #212529;
            text-decoration: none;
        }
        .btn-delete:hover, .btn-edit:hover {
            opacity: 0.8;
        }
        .no-reviews {
            text-align: center;
            padding: 3rem;
            background-color: #e9ecef;
            border-radius: 8px;
            font-size: 1.1rem;
            color: #6c757d;
        }
/* 
 */
 .thumbnail-images img {
        cursor: pointer;
        transition: transform 0.3s;
    }
    
    .thumbnail-images img:hover {
        transform: scale(1.05);
    }

    .zoom-container {
        position: relative;
        overflow: hidden;
    }

    .product-zoom {
        transition: transform 0.5s ease;
    }

    .zoom-container:hover .product-zoom {
        transform: scale(1.2); /* Adjust the zoom level as needed */
    }
    
    .product-rating .star {
        font-size: 1.5rem;
        color: #FFD700; /* Gold color for stars */
    }
    
    .product-price .line-through {
        text-decoration: line-through;
        color: #ff0000; /* Red color for original price */
    }

    .size-button {
        margin: 0.2rem;
    }

    .btn-custom {
        background-color: #28a745;
        color: white;
    }
    
    .btn-custom:hover {
        background-color: #218838;
    }
    
    .btn-wishlist {
        border: 2px solid #dc3545;
    }

    .btn-wishlist:hover {
        background-color: #dc3545;
        color: white;
    }
    /*  */
    .related-products-section {
    background-color: #f8f9fa;
}

.section-title {
    font-size: 2.5rem;
    font-weight: 700;
    color: #333;
    position: relative;
    padding-bottom: 15px;
}

.section-title::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 50px;
    height: 3px;
    background-color: #007bff;
}

.product-card {
    background-color: #fff;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    height: 100%;
}

.product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
}

.product-image-wrapper {
    position: relative;
    overflow: hidden;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
}

.product-image-carousel {
    position: relative;
    padding-top: 100%; /* 1:1 Aspect Ratio */
}

.product-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0;
    transition: opacity 0.5s ease;
}

.product-image.active {
    opacity: 1;
}

.product-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.product-image-wrapper:hover .product-overlay {
    opacity: 1;
}

.btn-wishlist {
    position: absolute;
    top: 10px;
    right: 10px;
    background-color: #fff;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 1;
}

.btn-wishlist i {
    color: #ccc;
    font-size: 1.2rem;
    transition: color 0.3s ease;
}

.btn-wishlist.active i,
.btn-wishlist:hover i {
    color: #dc3545;
}

.product-info {
    padding: 1rem;
}

.product-title {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #333;
}

.product-rating {
    font-size: 0.9rem;
}

.rating-count {
    color: #6c757d;
    font-size: 0.8rem;
    margin-left: 5px;
}

.product-price {
    font-weight: 600;
    margin-top: 0.5rem;
}

.original-price {
    text-decoration: line-through;
    color: #6c757d;
    margin-right: 5px;
}

.final-price {
    color: #28a745;
}

.discount-badge {
    background-color: #dc3545;
    color: #fff;
    font-size: 0.8rem;
    padding: 2px 5px;
    border-radius: 3px;
    margin-left: 5px;
}

.product-availability .badge {
    font-size: 0.8rem;
    font-weight: 500;
}
#zoomed-image-container {
    display: none; /* Hidden by default */
    top: 0;
    left: 0;
    pointer-events: none; /* Prevents mouse events from interacting with the container */
    z-index: 1000; /* Ensures the zoomed image is on top */
}

#zoomed-image {
    position: absolute;
    border: 2px solid #000; /* Optional: add a border for better visibility */
}

.product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 40px;
            padding: 20px;
        }

        .product-box {
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: all 0.4s ease;
            text-decoration: none;
            color: inherit;
            display: flex;
            flex-direction: column;
        }

        .product-box:hover {
            transform: translateY(-15px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .product-images {
            position: relative;
            height: 300px;
            overflow: hidden;
        }

        .product-images img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }

        .product-images img.active {
            opacity: 1;
            transform: scale(1.05);
        }

        .product-content {
            padding: 25px;
        }

        .product-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-color);
        }

        .product-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .price-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .original-price {
            text-decoration: line-through;
            color: #999;
            font-size: 0.9rem;
        }

        .final-price {
            font-size: 1.6rem;
            color: var(--accent-color);
            font-weight: bold;
        }

        .discount-percentage {
            background-color: var(--accent-color);
            color: white;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-top: 5px;
        }

        .stock-status {
            font-size: 0.9rem;
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 20px;
        }

        .in-stock {
            background-color: var(--secondary-color);
            color: white;
        }

        .out-of-stock {
            background-color: var(--accent-color);
            color: white;
        }

        .text-danger {
            color: var(--accent-color);
        }

        .text-muted {
            color: #95a5a6;
        }

        @media (max-width: 768px) {
            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 30px;
            }
        }
        /* reivew */
        #ratings-reviews {
    background-color: #f8f9fa;
}

.product-rating .fas.fa-star,
.product-rating .far.fa-star {
    color: #ffc107;
}

.star-rating {
    display: inline-flex;
    flex-direction: row-reverse;
    font-size: 1.5em;
    justify-content: space-around;
    padding: 0 .2em;
    text-align: center;
    width: 5em;
}

.star-rating input {
    display: none;
}

.star-rating label {
    color: #ccc;
    cursor: pointer;
}

.star-rating :checked ~ label {
    color: #f90;
}

.star-rating label:hover,
.star-rating label:hover ~ label {
    color: #fc0;
}

.review-item {
    transition: transform 0.3s ease-in-out;
}

.review-item:hover {
    transform: translateY(-5px);
}

#addReviewBtn {
    transition: all 0.3s ease;
}

#addReviewBtn:hover {
    transform: scale(1.05);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/elevatezoom/3.0.8/jquery.elevatezoom.min.js"></script>
</head>
</head>

<body>
    
    <nav class="navbar navbar-expand-lg navbar-light bg-light py-3 w-100">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <img src="/img/logo.png" alt="Logo" class="d-inline-block align-text-top" style="height: 40px;">
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/products">Products</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/about">About</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/auth/signin">
                            <img src="/img/log-in.png" alt="Login" class="nav-icon" style="height: 24px;">
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/user/wishlist">
                            <img src="/img/wishlist.png" alt="Wishlist" class="nav-icon" style="height: 24px;">
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/cart">
                            <img src="/img/cart.png" alt="Cart" class="nav-icon" style="height: 24px;">
                            <span class="badge badge-pill badge-danger"></span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/user/profile">
                            <img src="/img/userprofile.jpg" alt="User Profile" class="nav-icon rounded-circle" style="height: 24px;">
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container mt-5">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb bg-transparent">
                <li class="breadcrumb-item"><a href="/" class="text-muted">Home</a></li>
                <li class="breadcrumb-item"><a href="/category/<%= product.category %>" class="text-muted"><%= product.category %></a></li>
                <li class="breadcrumb-item active" aria-current="page"><%= product.product %></li>
            </ol>
        </nav>
    
        <!-- Product Detail Section -->
        <div class="product-detail row">
            <div class="col-lg-6 mb-4">
                <!-- Main Product Image -->
                <div class="main-image-container position-relative overflow-hidden rounded shadow-sm">
                    <img id="main-product-image" src="<%= product.images[0].secured_url %>" alt="<%= product.product %>" class="img-fluid w-100">
                    <div id="zoomed-image-container" class="position-absolute" style="display:none;">
                        <img id="zoomed-image" src="" alt="Zoomed Image" style="width:300%; height:auto;"/>
                    </div>
                </div>
            
                <!-- Thumbnail Images -->
                <div class="thumbnail-images mt-3">
                    <div class="row">
                        <% product.images.forEach((image, index) => { %>
                            <div class="col-3 mb-3">
                                <img src="<%= image.secured_url %>" 
                                     alt="<%= product.product %>" 
                                     class="img-thumbnail thumbnail" 
                                     onclick="changeMainImage('<%= image.secured_url %>', <%= index %>)">
                            </div>
                        <% }) %>
                    </div>
                </div>
            </div>
    
            <div class="col-lg-6 product-info">
                <h1 class="product-title mb-3"><%= product.product %></h1>
    
                <div class="d-flex align-items-center mb-3">
                    <div class="product-rating mr-3">
                        <% for (let i = 1; i <= 5; i++) { %>
                            <% if (i <= product.rating) { %>
                                <i class="fas fa-star text-warning"></i>
                            <% } else { %>
                                <i class="far fa-star text-warning"></i>
                            <% } %>
                        <% } %>
                    </div>
                    <span class="text-muted">(<%= product.rating %> / 5)</span>
                </div>
    
                <div class="pricing mb-4">
                    <% if(isOffer) { %>
                        <p class="product-price mb-0">
                            <span class="text-muted text-decoration-line-through h5">$<%= product.price.toFixed(2) %></span>
                            <span class="ml-2 h3 text-success font-weight-bold">$<%= product.finalPrice.toFixed(2) %></span>
                        </p>
                        <span class="badge badge-danger">Sale</span>
                    <% } else { %>
                        <p class="product-price h3 text-success font-weight-bold mb-0">$<%= product.finalPrice.toFixed(2) %></p>
                    <% } %>
                </div>
    
                <p class="product-description text-muted mb-4"><%= product.description %></p>
                
                <div class="size-selection mb-4">
                    <h5 class="mb-3">Select Size:</h5>
                    <% if (product.sizes.length > 0) { %>
                        <div class="size-buttons">
                            <% product.sizes.forEach(size => { %>
                                <button type="button" class="btn btn-outline-secondary size-button mr-2 mb-2" data-size="<%= size.size %>" onclick="selectSize(this)"><%= size.size %></button>
                            <% }) %>
                        </div>
                    <% } else { %>
                        <p class="text-muted">No sizes available</p>
                    <% } %>
                </div>
    
                <div class="d-flex flex-wrap mb-4">
                    <form id="addToCartForm" class="mr-2 mb-2">
                        <input type="hidden" name="productId" value="<%= product._id %>">
                        <input type="hidden" name="size" id="selectedSize">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-shopping-cart mr-2"></i>Add to Cart
                        </button>
                    </form>
    
                    <form id="wishlistForm" class="mb-2">
                        <input type="hidden" name="productId" id="productId" value="<%= product.id %>">
                        
                        <button type="submit" class="btn btn-outline-danger btn-lg">
                            <i class="far fa-heart mr-2"></i>Add to Wishlist
                        </button>
                    </form>
                </div>
    
               
            </div>
        </div>
    </div>


</div>
<div class="reviews-container">
    <h2 class="section-title">Customer Feedback</h2>
    
    <div class="row">
        <div class="col-md-4">
            <div class="rating-summary">
                <div class="rating-number">4.0</div>
                <div class="star-rating">
                    <% for (let i = 1; i <= 5; i++) { %>
                        <% if (i <= Math.round(product.rating)) { %>
                            <i class="fas fa-star"></i>
                        <% } else { %>
                            <i class="far fa-star"></i>
                        <% } %>
                    <% } %>
                </div>
                <div class="review-count"><%= product.reviews.length %> reviews</div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="rating-bars">
                <% for (let i = 5; i >= 1; i--) { %>
                    <div class="rating-bar">
                        <div class="bar-label"><%= i %> <i class="fas fa-star" style="color: #ffd700;"></i></div>
                        <div class="progress">
                            <% const percentage = (product.reviews.filter(review => review.rating === i).length / product.reviews.length) * 100 %>
                            <div class="progress-bar" style="width: <%= percentage %>%"></div>
                        </div>
                        <div class="bar-value"><%= Math.round(percentage) %>%</div>
                    </div>
                <% } %>
            </div>
        </div>
    </div>

    <a href="/user/review/add/<%=product._id%>" class="btn-review">Write a Review</a>
   
    <div id="reviewsList" class="mt-5">
        <% if (product.reviews.length > 0) { %>
            <% product.reviews.forEach(review => { %>
                <div class="review-item">
                    <div class="review-header">
                        <div class="user-info">
                            <img src="https://i.pravatar.cc/150?u=<%= review.user._id %>" alt="User Avatar" class="user-avatar">
                            <div>
                                <div class="user-name"><%= review.user.name %></div>
                                <div class="star-rating">
                                    <% for (let i = 5; i >= 1; i--) { %>  <!-- Start from 5 and go to 1 -->
                                        <% if (i <= review.rating) { %>
                                            <i class="fas fa-star"></i>  <!-- Filled star -->
                                        <% } else { %>
                                            <i class="far fa-star"></i>   <!-- Empty star -->
                                        <% } %>
                                    <% } %>
                                </div>
                                
                            </div>
                        </div>
                        <div class="review-date">
                            <%= new Date(review.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %>
                        </div>
                    </div>
                    <p class="review-content"><%= review.comment %></p>

                    <% if (review.user._id.toString() === currentUserId.toString()) { %>
                        <button class="btn-delete" onclick="deleteReview('<%= review._id %>', '<%= product._id %>')">Delete</button>
                        <a href="/user/review/edit/<%= review._id %>" class="btn-edit">Edit</a>
                    <% } %>
                </div>
            <% }) %>
        <% } else { %>
            <div class="no-reviews">
                <i class="fas fa-comment-alt fa-3x mb-3"></i>
                <p>No reviews yet. Be the first to share your thoughts!</p>
            </div>
        <% } %>
    </div>
</div>
   <!-- Related Products Section -->
<section class="related-products-section py-5 bg-light">
    <div class="container">
        <h2>Related Products</h2>
        <div class="product-grid">
            <% for (const product of relatedProducts) { %>
                <div class="product-box">
                    <a href="/product-detail/<%= product._id %>">
                        <div class="product-images" onmouseover="startSlideshow(this)" onmouseout="stopSlideshow(this)">
                            <% for (const image of product.images) { %>
                                <img src="<%= image.secured_url %>" alt="Product Image" class="<%= image === product.images[0] ? 'active' : '' %>">
                            <% } %>
                        </div>
                    </a>
                    <div class="product-content">
                        <h3 class="product-title"><%= product.product %></h3>
                        
                        <div class="product-details">
                            <div class="price-container">
                                <% if (product.offerApplied) { %>
                                    <span class="original-price">$<%= product.price.toFixed(2) %></span>
                                    <span class="final-price">$<%= product.finalPrice.toFixed(2) %></span>
                                    <%
                                        const discountPercentage = ((product.price - product.finalPrice) / product.price) * 100;
                                    %>
                                    <span class="discount-percentage"><%= discountPercentage.toFixed(0) %>% off</span>
                                <% } else { %>
                                    <span class="final-price">$<%= product.price.toFixed(2) %></span>
                                <% } %>
                            </div>
                            <span class="stock-status <%= product.sizes.some(size => size.stock > 0) ? 'in-stock' : 'out-of-stock' %>">
                                <%= product.sizes.some(size => size.stock > 0) ? 'In Stock' : 'Out of Stock' %>
                            </span>
                        </div>
                    </div>
                </div>
            <% } %>
        </div>
    </div>
    </div>
</section>

<% if (productOne && Array.isArray(productOne.purchasedByUserIds) && productOne.purchasedByUserIds.includes(user)) { %>
    <h1>Can review</h1>
<% } else { %>
    <h1>No add review</h1>
<% } %>


    <%- include('partials/footer') %>
 <!-- Bootstrap JS and dependencies -->
 <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
 <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
 <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
 
 <script>
     function startSlideshow(element) {
         element.slideshowInterval = setInterval(() => {
             const images = element.querySelectorAll('img');
             const activeImage = element.querySelector('img.active');
             const nextImage = activeImage.nextElementSibling || images[0];
             activeImage.classList.remove('active');
             nextImage.classList.add('active');
         }, 1000);
     }

     function stopSlideshow(element) {
         clearInterval(element.slideshowInterval);
         const images = element.querySelectorAll('img');
         images.forEach((img, index) => {
             img.classList.toggle('active', index === 0);
         });
     }
 </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        $(document).ready(function() {
            // Initialize image zoom
            $('#main-product-image').elevateZoom({
                zoomType: "inner",
                cursor: "crosshair",
                zoomWindowFadeIn: 500,
                zoomWindowFadeOut: 750
            });

            // Handle size selection
            let selectedSize = null;
            $('.size-button').on('click', function() {
                selectedSize = $(this).data('size');
                $('#selectedSize').val(selectedSize);
                $('.size-button').removeClass('btn-primary').addClass('btn-outline-primary');
                $(this).removeClass('btn-outline-primary').addClass('btn-primary');
            });

            $('#addToCartForm').on('submit', function(e) {
    e.preventDefault();

    // Check if a size is selected
    if (!selectedSize) {
        Swal.fire({
            icon: 'warning',
            title: 'Size Required',
            text: 'Please select a size before adding the product to your cart.',
            confirmButtonText: 'OK'
        });
        return;
    }

    // Fetch API to submit form data
    fetch('/cart/add', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            productId: $('input[name="productId"]').val(),
            size: selectedSize
        })
    })
    .then(response => {
        if (response.status === 401) { // Unauthorized
            return response.text().then(text => {
                Swal.fire({
                    icon: 'warning',
                    title: 'Unauthorized',
                    text: 'You need to log in to add items to the cart.',
                    confirmButtonText: 'Login',
                    onClose: () => {
                        window.location.href = '/auth/signin'; // Redirect to login page
                    }
                });
            });
        } else if (response.ok) { // Check if the response is ok (status code in the range 200-299)
            return response.json().then(data => {
                // Ensure data is an object with the expected properties
                if (data && typeof data === 'object') {
                    Swal.fire({
                        icon: 'success',
                        title: 'Added to Cart',
                        text: data.message || 'Item added to cart successfully.',
                        confirmButtonText: 'OK'
                    });
                } else {
                    throw new Error('Unexpected response format.');
                }
            });
        } 
        else if(response.status===403){
            return response.json().then(data => {
                // Ensure data is an object with the expected properties
                if (data && typeof data === 'object') {
                    Swal.fire({
                        icon: 'warning',
                        title: 'limit',
                        text: data.message || 'error occured.',
                        confirmButtonText: 'OK'
                    });
                } else {
                    throw new Error('Unexpected response format.');
                }
            });
        }
        else {
            return response.text().then(text => {
                throw new Error(text || 'Something went wrong');
            });
        }
    })
    .catch(error => {
        console.error('Error adding to cart:', error);
        Swal.fire({
            icon: 'error',
            title: 'Error',
            text: error.message || 'There was a problem adding the product to your cart. Please try again later.',
            confirmButtonText: 'OK'
        });
    });
});

            // Function to change the main image and update zoom
            window.changeMainImage = function(imageUrl, index) {
                const mainImage = $('#main-product-image');
                mainImage.attr('src', imageUrl);
                mainImage.data('zoom-image', imageUrl);
                mainImage.elevateZoom({
                    zoomType: "inner",
                    cursor: "crosshair",
                    zoomWindowFadeIn: 500,
                    zoomWindowFadeOut: 750
                });

                // Update active thumbnail
                $('.thumbnail').removeClass('active-thumbnail');
                $('.thumbnail').eq(index).addClass('active-thumbnail');
            };

            // Wishlist functionality
            $('#wishlistForm').on('submit', function(e) {
                e.preventDefault();
                const productId = $('#productId').val();
                
                fetch(`/user/wishlist/add/${productId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        Swal.fire('Success!', 'Product added to wishlist', 'success');
                    } else {
                        Swal.fire('Oops!', 'This product is already in your wishlist!', 'info');
                    }
                })
                .catch(error => {
                    Swal.fire('Error!', 'An error occurred. Please try again later.', 'error');
                });
            });
        });
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>
    
   <!-- <script>
    // Wait until the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', function () {
        // Ensure the form element is properly targeted
        const wishlistForm = document.getElementById('wishlistForm');
        const productId = document.getElementById('productId').value;

        if (wishlistForm) {
            wishlistForm.addEventListener('submit', wish);
        }

        async function wish(event) {
            event.preventDefault(); // Prevent default form submission

            const url = `/user/wishlist/add/${productId}`;
            const options = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({})
            };

            try {
                const response = await fetch(url, options);
                const result = await response.json();
                console.log('result', result);

                if (response.ok) {
                    swal("Success!", "Product added to wishlist", "success");
                } else {
                    swal("Oops!", "This product is already in your wishlist!", "info");
                }

            } catch (error) {
                window.alert(error.message);
            }
        }
    });
</script> -->
<script>
    function changeCarouselImage(index) {
        $('#productCarousel').carousel(index);
    }

    function selectSize(button) {
        document.getElementById('selectedSize').value = button.getAttribute('data-size');
    }
</script>
<script>
    // Function to change the main image
function changeMainImage(imageUrl, index) {
    document.getElementById('main-product-image').src = imageUrl;
    
    // Update active thumbnail
    document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
        if (i === index) {
            thumb.classList.add('active-thumbnail');
        } else {
            thumb.classList.remove('active-thumbnail');
        }
    });
}

// Function to open the zoom modal
function openZoomModal() {
    const mainImage = document.getElementById('main-product-image');
    const zoomedImage = document.getElementById('zoomedImage');
    zoomedImage.src = mainImage.src;
    $('#imageZoomModal').modal('show');
}

// Event listener for thumbnail clicks
document.addEventListener('DOMContentLoaded', function() {
    const thumbnails = document.querySelectorAll('.thumbnail');
    thumbnails.forEach((thumb, index) => {
        thumb.addEventListener('click', function() {
            changeMainImage(this.src, index);
        });
    });
});
</script>
<script>
    $(document).ready(function() {
        const mainImage = $('#main-product-image');
        const zoomedImage = $('#zoomed-image');
        const zoomedImageContainer = $('#zoomed-image-container');

        // Initialize Elevate Zoom
        function initZoom() {
            mainImage.elevateZoom({
                zoomType: "lens",
                lensShape: "round",
                lensSize: 200,
                scrollZoom: true,
                onImageLoad: function() {
                    zoomedImage.attr('src', mainImage.attr('src'));
                },
                onZoomedImageLoad: function() {
                    zoomedImageContainer.show();
                }
            });
        }

        // Change the main image and update the zoom
        window.changeMainImage = function(imageUrl, index) {
            mainImage.attr('src', imageUrl); // Change the main image
            zoomedImage.attr('src', imageUrl); // Update the zoomed image
            initZoom(); // Re-initialize the zoom for the new image
        };

        // Initialize zoom on page load
        initZoom();
    });
</script>
<script>
    function deleteReview(reviewId, productId) {
        // Use SweetAlert2 for confirmation
        Swal.fire({
            title: 'Are you sure?',
            text: 'Do you really want to delete this review?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!',
            cancelButtonText: 'No, keep it'
        }).then((result) => {
            if (result.isConfirmed) {
                // Proceed with deletion if confirmed
                fetch(`/user/review/delete/${reviewId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ productId }) // Send the productId in the request body if needed
                })
                .then(response => {
                    // Check if the response is ok
                    if (response.ok) {
                        return response.json(); // If response is OK, parse JSON
                    } else {
                        throw new Error('Failed to delete review'); // Throw an error if not OK
                    }
                })
                .then(data => {
                    // Check if your response contains the expected data
                    if (data.message) {
                        Swal.fire(
                            'Deleted!',
                            'Your review has been deleted.',
                            'success'
                        );
                        location.reload();
                        // Check if the element exists before trying to remove it
                        const reviewElement = document.getElementById(`review-${reviewId}`);
                        if (reviewElement) {
                            reviewElement.remove(); // Remove the review element
                        } else {
                            console.warn(`Element with ID review-${reviewId} not found.`);
                        }
                    } else {
                        throw new Error('Unexpected response format'); // Handle unexpected format
                    }
                })
                .catch(error => {
                    console.error('There was a problem with the delete operation:', error);
                    Swal.fire(
                        'Error!',
                        error.message || 'There was an error deleting the review.',
                        'error'
                    );
                });
            }
        });
    }
    </script>
    
    
</body>

</html>
