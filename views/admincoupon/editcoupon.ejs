<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Edit Coupon</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet" />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
            rel="stylesheet" />
        <style>
      body {
        background-color: #f8f9fa;
        color: #212529;
      }

      .main-content {
        padding: 30px;
        max-width: 800px;
        margin: 0 auto;
      }

      .page-title {
        font-weight: 600;
        margin-bottom: 20px;
      }

      .card {
        border: none;
        border-radius: 12px;
        box-shadow: 0px 4px 12px rgba(0,0,0,0.05);
      }

      .form-control, .form-select {
        border-radius: 6px;
      }

      #error-message {
        display: none;
      }
    </style>
    </head>
    <body>
        <div class="main-content">
            <h2 class="page-title">Edit Coupon</h2>

            <div class="card p-4">
                <form id="editCouponForm">
                    <div class="mb-3">
                        <label for="couponCode" class="form-label">Coupon
                            Code</label>
                        <input type="text" class="form-control" id="couponCode"
                            name="couponCode" value="<%= coupon.couponCode %>"
                            required />
                    </div>

                    <div class="mb-3">
                        <label for="discountType" class="form-label">Discount
                            Type</label>
                        <select class="form-select" id="discountType"
                            name="discountType" required>
                            <option value="percentage" <%=coupon.discountType
                                === 'percentage' ? 'selected' : ''
                                %>>Percentage</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="discountValue" class="form-label">Discount
                            Value (%)</label>
                        <input type="number" class="form-control"
                            id="discountValue"
                            name="discountValue"
                            value="<%= coupon.discountValue %>" min="1" max="60"
                            required />
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="startDate" class="form-label">Start
                                Date</label>
                            <input type="date" class="form-control"
                                id="startDate"
                                name="startDate"
                                value="<%= coupon.startDate.toISOString().split('T')[0] %>"
                                required />
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="endDate" class="form-label">End
                                Date</label>
                            <input type="date" class="form-control" id="endDate"
                                name="endDate"
                                value="<%= coupon.endDate.toISOString().split('T')[0] %>"
                                required />
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="minPurchaseAmount"
                            class="form-label">Minimum Purchase Amount</label>
                        <input type="number" class="form-control"
                            id="minPurchaseAmount"
                            name="minPurchaseAmount"
                            value="<%= coupon.minPurchaseAmount %>" min="400"
                            required />
                    </div>

                    <div class="mb-3">
                        <label for="usageLimit" class="form-label">Usage
                            Limit</label>
                        <input type="number" class="form-control"
                            id="usageLimit"
                            name="usageLimit" value="<%= coupon.usageLimit %>"
                            min="1" required />
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Update Coupon
                    </button>
                    <a href="/admin/coupons"
                        class="btn btn-secondary ms-2">Cancel</a>
                </form>

                <div id="error-message" class="alert alert-danger mt-3"></div>
            </div>
        </div>

        <script>
      document.getElementById('editCouponForm').addEventListener('submit', edit);

      async function edit(event) {
        event.preventDefault();

        const couponCode = document.getElementById('couponCode').value;
        const discountType = document.getElementById('discountType').value;
        const discountValue = document.getElementById('discountValue').value;
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        const minPurchaseAmount = document.getElementById('minPurchaseAmount').value;
        const usageLimit = document.getElementById('usageLimit').value;

        const url = `/admin/coupon/edit/<%= coupon._id %>?_method=PATCH`;

        try {
          const response = await fetch(url, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              couponCode,
              discountType,
              discountValue,
              startDate,
              endDate,
              minPurchaseAmount,
              usageLimit
            })
          });

          const result = await response.json();

          if (response.ok) {
            window.location.href = '/admin/coupons';
          } else {
            showError(result.message);
          }
        } catch (error) {
          showError('An error occurred. Please try again.');
        }
      }

      function showError(message) {
        const errorDiv = document.getElementById('error-message');
        errorDiv.innerText = message;
        errorDiv.style.display = 'block';
      }
    </script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    </body>
</html>
