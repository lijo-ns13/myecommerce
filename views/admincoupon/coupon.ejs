<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Coupon Management</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet" />
        <link
            href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
            rel="stylesheet" />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
            rel="stylesheet" />
        <style>
      body {
        background-color: #f8f9fa;
        color: #212529;
      }

      .content {
        padding: 30px;
        max-width: 1200px;
        margin: 0 auto;
      }

      .page-title {
        font-weight: 600;
        margin-bottom: 20px;
      }

      .card {
        border: none;
        border-radius: 12px;
        box-shadow: 0px 4px 12px rgba(0,0,0,0.05);
      }

      .table thead {
        background-color: #f1f3f5;
      }

      .btn-sm {
        padding: 4px 10px;
        font-size: 14px;
      }

      .btn {
        border-radius: 6px;
      }

      .table td, .table th {
        vertical-align: middle;
      }
    </style>
    </head>
    <body>
        <div class="content">
            <h2 class="page-title">Coupon Management</h2>
            <a href="/admin/coupon/add-coupon" class="btn btn-success mb-3">
                <i class="fas fa-plus"></i> Add Coupon
            </a>

            <div class="card p-3">
                <div class="table-responsive">
                    <table
                        class="table table-bordered table-striped align-middle">
                        <thead>
                            <tr>
                                <th scope="col">Coupon Code</th>
                                <th scope="col">Discount (%)</th>
                                <th scope="col">Min Purchase Amount</th>
                                <th scope="col">Expiry Date</th>
                                <th scope="col">Usage Limit</th>
                                <th scope="col" class="text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if (coupons && coupons.length > 0) { %>
                            <% for (const coupon of coupons) { %>
                            <tr>
                                <td><%= coupon.couponCode %></td>
                                <td><%= coupon.discountValue %></td>
                                <td><%= coupon.minPurchaseAmount %></td>
                                <td><%= new
                                    Date(coupon.endDate).toLocaleDateString()
                                    %></td>
                                <td><%= coupon.usageLimit %></td>
                                <td class="text-center">
                                    <a
                                        href="/admin/coupon/edit/<%= coupon._id %>"
                                        class="btn btn-primary btn-sm me-1">
                                        <i class="fas fa-edit"></i> Edit
                                    </a>
                                    <button type="button"
                                        class="btn btn-danger btn-sm"
                                        onclick="confirmDelete('<%= coupon._id %>')">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                            </tr>
                            <% } %>
                            <% } else { %>
                            <tr>
                                <td colspan="6"
                                    class="text-center text-muted">No coupons
                                    available</td>
                            </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script
            src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
        <script>
      function confirmDelete(couponId) {
        Swal.fire({
          title: 'Are you sure?',
          text: "You won't be able to revert this!",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
          if (result.isConfirmed) {
            fetch(`/admin/coupon/delete/${couponId}?_method=DELETE`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' }
            })
              .then(response => response.json())
              .then(data => {
                if (data.success) {
                  Swal.fire('Deleted!','Your coupon has been deleted.','success')
                    .then(() => location.reload());
                } else {
                  Swal.fire('Error!','Problem deleting the coupon.','error');
                }
              })
              .catch(() => {
                Swal.fire('Error!','There was an error processing your request.','error');
              });
          }
        });
      }
    </script>
    </body>
</html>
